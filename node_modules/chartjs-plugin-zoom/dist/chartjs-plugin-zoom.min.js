/*!
* chartjs-plugin-zoom v2.1.0
* https://www.chartjs.org/chartjs-plugin-zoom/2.1.0/
 * (c) 2016-2024 chartjs-plugin-zoom Contributors
 * Released under the MIT License
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("hammerjs"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs","chart.js/helpers"],t):(n="undefined"!=typeof globalThis?globalThis:n||self).ChartZoom=t(n.Chart,n.Hammer,n.Chart.helpers)}(this,(function(n,t,e){"use strict";const o=n=>n&&n.enabled&&n.modifierKey,a=(n,t)=>n&&t[n+"Key"],i=(n,t)=>n&&!t[n+"Key"];function c(n,t,e){return void 0===n||("string"==typeof n?-1!==n.indexOf(t):"function"==typeof n&&-1!==n({chart:e}).indexOf(t))}function r(n,t){return"function"==typeof n&&(n=n({chart:t})),"string"==typeof n?{x:-1!==n.indexOf("x"),y:-1!==n.indexOf("y")}:{x:!1,y:!1}}function s(n,t,o){const{mode:a="xy",scaleMode:i,overScaleMode:c}=n||{},s=function({x:n,y:t},e){const o=e.scales,a=Object.keys(o);for(let e=0;e<a.length;e++){const i=o[a[e]];if(t>=i.top&&t<=i.bottom&&n>=i.left&&n<=i.right)return i}return null}(t,o),l=r(a,o),m=r(i,o);if(c){const n=r(c,o);for(const t of["x","y"])n[t]&&(m[t]=l[t],l[t]=!1)}if(s&&m[s.axis])return[s];const u=[];return e.each(o.scales,(function(n){l[n.axis]&&u.push(n)})),u}const l=new WeakMap;function m(n){let t=l.get(n);return t||(t={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},l.set(n,t)),t}function u(n,t,e,o){const a=Math.max(0,Math.min(1,(n-t)/e||0));return{min:o*a,max:o*(1-a)}}function d(n,t){const e=n.isHorizontal()?t.x:t.y;return n.getValueForPixel(e)}function f(n,t,e){const o=n.max-n.min,a=o*(t-1);return u(d(n,e),n.min,o,a)}function p(n,t,o,a,i){let c=o[a];if("original"===c){const o=n.originalScaleLimits[t.id][a];c=e.valueOrDefault(o.options,o.scale)}return e.valueOrDefault(c,i)}function h(n,{min:t,max:o},a,i=!1){const c=m(n.chart),{options:r}=n,s=function(n,t){return t&&(t[n.id]||t[n.axis])||{}}(n,a),{minRange:l=0}=s,u=p(c,n,s,"min",-1/0),d=p(c,n,s,"max",1/0);if("pan"===i&&(t<u||o>d))return!0;const f=n.max-n.min,h=i?Math.max(o-t,l):f;if(i&&h===l&&f<=l)return!0;const g=function(n,{min:t,max:o,minLimit:a,maxLimit:i},c){const r=(n-o+t)/2;t-=r,o+=r;const s=c.min.options??c.min.scale,l=c.max.options??c.max.scale,m=n/1e6;return e.almostEquals(t,s,m)&&(t=s),e.almostEquals(o,l,m)&&(o=l),t<a?(t=a,o=Math.min(a+n,i)):o>i&&(o=i,t=Math.max(i-n,a)),{min:t,max:o}}(h,{min:t,max:o,minLimit:u,maxLimit:d},c.originalScaleLimits[n.id]);return r.min=g.min,r.max=g.max,c.updatedScaleLimits[n.id]=g,n.parse(g.min)!==n.min||n.parse(g.max)!==n.max}const g=n=>0===n||isNaN(n)?0:n<0?Math.min(Math.round(n),-1):Math.max(Math.round(n),1);const x={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function b(n,t,e,o=!1){const{min:a,max:i,options:c}=n,r=c.time&&c.time.round,s=x[r]||0,l=n.getValueForPixel(n.getPixelForValue(a+s)-t),m=n.getValueForPixel(n.getPixelForValue(i+s)-t);return!(!isNaN(l)&&!isNaN(m))||h(n,{min:l,max:m},e,!!o&&"pan")}function y(n,t,e){return b(n,t,e,!0)}const v={category:function(n,t,e,o){const a=f(n,t,e);return n.min===n.max&&t<1&&function(n){const t=n.getLabels().length-1;n.min>0&&(n.min-=1),n.max<t&&(n.max+=1)}(n),h(n,{min:n.min+g(a.min),max:n.max-g(a.max)},o,!0)},default:function(n,t,e,o){const a=f(n,t,e);return h(n,{min:n.min+a.min,max:n.max-a.max},o,!0)},logarithmic:function(n,t,e,o){const a=function(n,t,e){const o=d(n,e);if(void 0===o)return{min:n.min,max:n.max};const a=Math.log10(n.min),i=Math.log10(n.max),c=i-a,r=u(Math.log10(o),a,c,c*(t-1));return{min:Math.pow(10,a+r.min),max:Math.pow(10,i-r.max)}}(n,t,e);return h(n,a,o,!0)}},w={default:function(n,t,e,o){h(n,function(n,t,e){const o=n.getValueForPixel(t),a=n.getValueForPixel(e);return{min:Math.min(o,a),max:Math.max(o,a)}}(n,t,e),o,!0)}},M={category:function(n,t,e){const o=n.getLabels().length-1;let{min:a,max:i}=n;const c=Math.max(i-a,1),r=Math.round(function(n){return n.isHorizontal()?n.width:n.height}(n)/Math.max(c,10)),s=Math.round(Math.abs(t/r));let l;return t<-r?(i=Math.min(i+s,o),a=1===c?i:i-c,l=i===o):t>r&&(a=Math.max(0,a-s),i=1===c?a:a+c,l=0===a),h(n,{min:a,max:i},e)||l},default:b,logarithmic:y,timeseries:y};function z(n,t){e.each(n,((e,o)=>{t[o]||delete n[o]}))}function k(n,t){const{scales:o}=n,{originalScaleLimits:a,updatedScaleLimits:i}=t;return e.each(o,(function(n){(function(n,t,e){const{id:o,options:{min:a,max:i}}=n;if(!t[o]||!e[o])return!0;const c=e[o];return c.min!==a||c.max!==i})(n,a,i)&&(a[n.id]={min:{scale:n.min,options:n.options.min},max:{scale:n.max,options:n.options.max}})})),z(a,o),z(i,o),a}function S(n,t,o,a){const i=v[n.type]||v.default;e.callback(i,[n,t,o,a])}function P(n,t,o,a){const i=w[n.type]||w.default;e.callback(i,[n,t,o,a])}function D(n){const t=n.chartArea;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function C(n,t,o="none"){const{x:a=1,y:i=1,focalPoint:c=D(n)}="number"==typeof t?{x:t,y:t}:t,r=m(n),{options:{limits:l,zoom:u}}=r;k(n,r);const d=1!==a,f=1!==i,p=s(u,c,n);e.each(p||n.scales,(function(n){n.isHorizontal()&&d?S(n,a,c,l):!n.isHorizontal()&&f&&S(n,i,c,l)})),n.update(o),e.callback(u.onZoom,[{chart:n}])}function L(n,t,o,a="none"){const i=m(n),{options:{limits:r,zoom:s}}=i,{mode:l="xy"}=s;k(n,i);const u=c(l,"x",n),d=c(l,"y",n);e.each(n.scales,(function(n){n.isHorizontal()&&u?P(n,t.x,o.x,r):!n.isHorizontal()&&d&&P(n,t.y,o.y,r)})),n.update(a),e.callback(s.onZoom,[{chart:n}])}function O(n){const t=m(n);let o=1,a=1;return e.each(n.scales,(function(n){const i=function(n,t){const o=n.originalScaleLimits[t];if(!o)return;const{min:a,max:i}=o;return e.valueOrDefault(i.options,i.scale)-e.valueOrDefault(a.options,a.scale)}(t,n.id);if(i){const t=Math.round(i/(n.max-n.min)*100)/100;o=Math.min(o,t),a=Math.max(a,t)}})),o<1?o:a}function Z(n,t,o,a){const{panDelta:i}=a,c=i[n.id]||0;e.sign(c)===e.sign(t)&&(t+=c);const r=M[n.type]||M.default;e.callback(r,[n,t,o])?i[n.id]=0:i[n.id]=t}function j(n,t,o,a="none"){const{x:i=0,y:c=0}="number"==typeof t?{x:t,y:t}:t,r=m(n),{options:{pan:s,limits:l}}=r,{onPan:u}=s||{};k(n,r);const d=0!==i,f=0!==c;e.each(o||n.scales,(function(n){n.isHorizontal()&&d?Z(n,i,l,r):!n.isHorizontal()&&f&&Z(n,c,l,r)})),n.update(a),e.callback(u,[{chart:n}])}function R(n){const t=m(n);k(n,t);const e={};for(const o of Object.keys(n.scales)){const{min:n,max:a}=t.originalScaleLimits[o]||{min:{},max:{}};e[o]={min:n.scale,max:a.scale}}return e}function E(n){const t=m(n);return t.panning||t.dragging}function F(n,t){const{handlers:e}=m(n),o=e[t];o&&o.target&&(o.target.removeEventListener(t,o),delete e[t])}function N(n,t,e,o){const{handlers:a,options:i}=m(n),c=a[e];if(c&&c.target===t)return;F(n,e),a[e]=t=>o(n,t,i),a[e].target=t;const r="wheel"!==e&&void 0;t.addEventListener(e,a[e],{passive:r})}function H(n,t){const e=m(n);e.dragStart&&(e.dragging=!0,e.dragEnd=t,n.update("none"))}function T(n,t){const e=m(n);e.dragStart&&"Escape"===t.key&&(F(n,"keydown"),e.dragging=!1,e.dragStart=e.dragEnd=null,n.update("none"))}function Y(n,t){const o=e.getRelativePosition(n,t),a=t.canvas.getBoundingClientRect();return e._isPointInArea(n,a)||(o.x=n.clientX-a.left,o.y=n.clientY-a.top),o}function A(n,t,o){const{onZoomStart:a,onZoomRejected:i}=o;if(a){const o=Y(t,n);if(!1===e.callback(a,[{chart:n,event:t,point:o}]))return e.callback(i,[{chart:n,event:t}]),!1}}function q(n,t){if(n.legend){const o=e.getRelativePosition(t,n);if(e._isPointInArea(o,n.legend))return}const c=m(n),{pan:r,zoom:s={}}=c.options;if(0!==t.button||a(o(r),t)||i(o(s.drag),t))return e.callback(s.onZoomRejected,[{chart:n,event:t}]);!1!==A(n,t,s)&&(c.dragStart=t,N(n,n.canvas.ownerDocument,"mousemove",H),N(n,window.document,"keydown",T))}function V(n,t,e,{min:o,max:a,prop:i}){n[o]=Math.max(0,Math.min(t[i],e[i])),n[a]=Math.max(t[i],e[i])}function X(n,t,e){const o=Y(t.dragStart,n),a=Y(t.dragEnd,n);if(e){!function(n,t,e){let o=n.x-t.x,a=n.y-t.y;const i=Math.abs(o/a);i>e?o=Math.sign(o)*Math.abs(a*e):i<e&&(a=Math.sign(a)*Math.abs(o/e)),n.x=t.x+o,n.y=t.y+a}(a,o,n.chartArea.width/n.chartArea.height)}return{beginPoint:o,endPoint:a}}function B(n,t,e,o){const a=c(t,"x",n),i=c(t,"y",n),{top:r,left:s,right:l,bottom:m,width:u,height:d}=n.chartArea,f={top:r,left:s,right:l,bottom:m},{beginPoint:p,endPoint:h}=X(n,e,o&&a&&i);a&&V(f,p,h,{min:"left",max:"right",prop:"x"}),i&&V(f,p,h,{min:"top",max:"bottom",prop:"y"});const g=f.right-f.left,x=f.bottom-f.top;return{...f,width:g,height:x,zoomX:a&&g?1+(u-g)/u:1,zoomY:i&&x?1+(d-x)/d:1}}function K(n,t){const o=m(n);if(!o.dragStart)return;F(n,"mousemove");const{mode:a,onZoomComplete:i,drag:{threshold:r=0,maintainAspectRatio:s}}=o.options.zoom,l=B(n,a,{dragStart:o.dragStart,dragEnd:t},s),u=c(a,"x",n)?l.width:0,d=c(a,"y",n)?l.height:0,f=Math.sqrt(u*u+d*d);if(o.dragStart=o.dragEnd=null,f<=r)return o.dragging=!1,void n.update("none");L(n,{x:l.left,y:l.top},{x:l.right,y:l.bottom},"zoom"),o.dragging=!1,o.filterNextClick=!0,e.callback(i,[{chart:n}])}function W(n,t){const{handlers:{onZoomComplete:a},options:{zoom:c}}=m(n);if(!function(n,t,a){if(i(o(a.wheel),t))e.callback(a.onZoomRejected,[{chart:n,event:t}]);else if(!1!==A(n,t,a)&&(t.cancelable&&t.preventDefault(),void 0!==t.deltaY))return!0}(n,t,c))return;const r=t.target.getBoundingClientRect(),s=c.wheel.speed,l=t.deltaY>=0?2-1/(1-s):1+s;C(n,{x:l,y:l,focalPoint:{x:t.clientX-r.left,y:t.clientY-r.top}}),e.callback(a,[{chart:n}])}function I(n,t,o,a){o&&(m(n).handlers[t]=function(n,t){let e;return function(){return clearTimeout(e),e=setTimeout(n,t),t}}((()=>e.callback(o,[{chart:n}])),a))}function _(n,t){return function(c,r){const{pan:s,zoom:l={}}=t.options;if(!s||!s.enabled)return!1;const m=r&&r.srcEvent;return!m||(!(!t.panning&&"mouse"===r.pointerType&&(i(o(s),m)||a(o(l.drag),m)))||(e.callback(s.onPanRejected,[{chart:n,event:r}]),!1))}}function U(n,t,e){if(t.scale){const{center:o,pointers:a}=e,i=1/t.scale*e.scale,r=e.target.getBoundingClientRect(),s=function(n,t){const e=Math.abs(n.clientX-t.clientX),o=Math.abs(n.clientY-t.clientY),a=e/o;let i,c;return a>.3&&a<1.7?i=c=!0:e>o?i=!0:c=!0,{x:i,y:c}}(a[0],a[1]),l=t.options.zoom.mode;C(n,{x:s.x&&c(l,"x",n)?i:1,y:s.y&&c(l,"y",n)?i:1,focalPoint:{x:o.x-r.left,y:o.y-r.top}}),t.scale=e.scale}}function G(n,t,e){const o=t.delta;o&&(t.panning=!0,j(n,{x:e.deltaX-o.x,y:e.deltaY-o.y},t.panScales),t.delta={x:e.deltaX,y:e.deltaY})}const J=new WeakMap;function Q(n,o){const a=m(n),i=n.canvas,{pan:c,zoom:r}=o,l=new t.Manager(i);r&&r.pinch.enabled&&(l.add(new t.Pinch),l.on("pinchstart",(t=>function(n,t,o){if(t.options.zoom.pinch.enabled){const a=e.getRelativePosition(o,n);e.callback(t.options.zoom.onZoomStart,[{chart:n,event:o,point:a}]),t.scale=1}}(n,a,t))),l.on("pinch",(t=>U(n,a,t))),l.on("pinchend",(t=>function(n,t,o){t.scale&&(U(n,t,o),t.scale=null,e.callback(t.options.zoom.onZoomComplete,[{chart:n}]))}(n,a,t)))),c&&c.enabled&&(l.add(new t.Pan({threshold:c.threshold,enable:_(n,a)})),l.on("panstart",(t=>function(n,t,o){const{enabled:a,onPanStart:i,onPanRejected:c}=t.options.pan;if(!a)return;const r=o.target.getBoundingClientRect(),l={x:o.center.x-r.left,y:o.center.y-r.top};if(!1===e.callback(i,[{chart:n,event:o,point:l}]))return e.callback(c,[{chart:n,event:o}]);t.panScales=s(t.options.pan,l,n),t.delta={x:0,y:0},G(n,t,o)}(n,a,t))),l.on("panmove",(t=>G(n,a,t))),l.on("panend",(()=>function(n,t){t.delta=null,t.panning&&(t.panning=!1,t.filterNextClick=!0,e.callback(t.options.pan.onPanComplete,[{chart:n}]))}(n,a)))),J.set(n,l)}function $(n){const t=J.get(n);t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy(),J.delete(n))}function nn(n,t,e){const o=e.zoom.drag,{dragStart:a,dragEnd:i}=m(n);if(o.drawTime!==t||!i)return;const{left:c,top:r,width:s,height:l}=B(n,e.zoom.mode,{dragStart:a,dragEnd:i},o.maintainAspectRatio),u=n.ctx;u.save(),u.beginPath(),u.fillStyle=o.backgroundColor||"rgba(225,225,225,0.3)",u.fillRect(c,r,s,l),o.borderWidth>0&&(u.lineWidth=o.borderWidth,u.strokeStyle=o.borderColor||"rgba(225,225,225)",u.strokeRect(c,r,s,l)),u.restore()}var tn={id:"zoom",version:"2.1.0",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(n,o,a){m(n).options=a,Object.prototype.hasOwnProperty.call(a.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(a.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(a.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),t&&Q(n,a),n.pan=(t,e,o)=>j(n,t,e,o),n.zoom=(t,e)=>C(n,t,e),n.zoomRect=(t,e,o)=>L(n,t,e,o),n.zoomScale=(t,o,a)=>function(n,t,o,a="none"){const i=m(n);k(n,i),h(n.scales[t],o,void 0,!0),n.update(a),e.callback(i.options.zoom?.onZoom,[{chart:n}])}(n,t,o,a),n.resetZoom=t=>function(n,t="default"){const o=m(n),a=k(n,o);e.each(n.scales,(function(n){const t=n.options;a[n.id]?(t.min=a[n.id].min.options,t.max=a[n.id].max.options):(delete t.min,delete t.max),delete o.updatedScaleLimits[n.id]})),n.update(t),e.callback(o.options.zoom.onZoomComplete,[{chart:n}])}(n,t),n.getZoomLevel=()=>O(n),n.getInitialScaleBounds=()=>R(n),n.getZoomedScaleBounds=()=>function(n){const t=m(n),e={};for(const o of Object.keys(n.scales))e[o]=t.updatedScaleLimits[o];return e}(n),n.isZoomedOrPanned=()=>function(n){const t=R(n);for(const e of Object.keys(n.scales)){const{min:o,max:a}=t[e];if(void 0!==o&&n.scales[e].min!==o)return!0;if(void 0!==a&&n.scales[e].max!==a)return!0}return!1}(n),n.isZoomingOrPanning=()=>E(n)},beforeEvent(n,{event:t}){if(E(n))return!1;if("click"===t.type||"mouseup"===t.type){const t=m(n);if(t.filterNextClick)return t.filterNextClick=!1,!1}},beforeUpdate:function(n,t,e){const o=m(n),a=o.options;o.options=e,function(n,t){const{pan:e,zoom:o}=n,{pan:a,zoom:i}=t;return o?.zoom?.pinch?.enabled!==i?.zoom?.pinch?.enabled||e?.enabled!==a?.enabled||e?.threshold!==a?.threshold}(a,e)&&($(n),Q(n,e)),function(n,t){const e=n.canvas,{wheel:o,drag:a,onZoomComplete:i}=t.zoom;o.enabled?(N(n,e,"wheel",W),I(n,"onZoomComplete",i,250)):F(n,"wheel"),a.enabled?(N(n,e,"mousedown",q),N(n,e.ownerDocument,"mouseup",K)):(F(n,"mousedown"),F(n,"mousemove"),F(n,"mouseup"),F(n,"keydown"))}(n,e)},beforeDatasetsDraw(n,t,e){nn(n,"beforeDatasetsDraw",e)},afterDatasetsDraw(n,t,e){nn(n,"afterDatasetsDraw",e)},beforeDraw(n,t,e){nn(n,"beforeDraw",e)},afterDraw(n,t,e){nn(n,"afterDraw",e)},stop:function(n){!function(n){F(n,"mousedown"),F(n,"mousemove"),F(n,"mouseup"),F(n,"wheel"),F(n,"click"),F(n,"keydown")}(n),t&&$(n),function(n){l.delete(n)}(n)},panFunctions:M,zoomFunctions:v,zoomRectFunctions:w};return n.Chart.register(tn),tn}));
